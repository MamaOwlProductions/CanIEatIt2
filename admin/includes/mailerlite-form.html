{% assign mailerlite = site.data.mailerlite %}
{% if mailerlite.form_id %}

<!-- MailerLite Email Signup Form -->
<div class="mailerlite-form" style="background: linear-gradient(135deg, #7c3aed, #8b5cf6); color: white; border-radius: 15px; padding: 2rem; margin: 2rem 0; text-align: center;">
  <h3 style="margin-bottom: 1rem; font-size: 1.4rem;">
    üéÅ {{ mailerlite.lead_magnet_title | default: "Get Our FREE Food Safety Cheat Sheet!" }}
  </h3>
  <p style="margin-bottom: 1.5rem; opacity: 0.9;">
    {{ mailerlite.lead_magnet_description | default: "Join 10,000+ people who get our weekly food safety tips and exclusive guides" }}
  </p>
  
  <form class="ml-form" action="https://static.mailerlite.com/webforms/submit/{{ mailerlite.form_id }}" 
        data-code="{{ mailerlite.form_id }}" method="post" target="_blank" 
        style="display: flex; gap: 1rem; max-width: 400px; margin: 0 auto; flex-wrap: wrap;">
    
    <input type="email" name="fields[email]" placeholder="Enter your email address" required
           style="flex: 1; min-width: 200px; padding: 0.8rem; border: none; border-radius: 25px; outline: none; font-family: inherit; font-size: 1rem;">
    
    <input type="hidden" name="ml-submit" value="1">
    
    <button type="submit" 
            style="background: #f59e0b; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-family: inherit; font-size: 1rem; white-space: nowrap;"
            onmouseover="this.style.background='#d97706'; this.style.transform='translateY(-1px)'"
            onmouseout="this.style.background='#f59e0b'; this.style.transform='translateY(0)'">
      Get Free Guide
    </button>
  </form>
  
  <p style="font-size: 0.8rem; margin-top: 1rem; opacity: 0.8;">
    No spam, unsubscribe at any time. Read our <a href="/privacy/" style="color: #fbbf24;">privacy policy</a>.
  </p>
</div>

<!-- MailerLite Success Handling -->
<script>
  // Handle form submission success
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('.ml-form');
    forms.forEach(form => {
      form.addEventListener('submit', function(e) {
        // Show loading state
        const button = this.querySelector('button[type="submit"]');
        const originalText = button.textContent;
        button.textContent = 'Sending...';
        button.disabled = true;
        
        // Reset after delay (form submits to new tab)
        setTimeout(() => {
          button.textContent = '‚úÖ Check Your Email!';
          button.style.background = '#22c55e';
          
          // Show success message
          const successMsg = document.createElement('div');
          successMsg.innerHTML = `
            <div style="background: #dcfce7; color: #166534; padding: 1rem; border-radius: 8px; margin-top: 1rem; border: 1px solid #bbf7d0;">
              <strong>Success!</strong> Check your email for the Food Safety Cheat Sheet download link.
            </div>
          `;
          this.appendChild(successMsg);
          
          // Reset form after delay
          setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
            button.style.background = '#f59e0b';
            if (successMsg.parentNode) {
              successMsg.remove();
            }
          }, 5000);
        }, 1000);
      });
    });
  });
</script>

<!-- MailerLite Universal Script -->
<!-- MailerLite Universal -->
<script>
    (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
    .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
    n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
    (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
    ml('account', '1642287');
</script>
<!-- End MailerLite Universal -->
{% else %}

<!-- MailerLite Placeholder (when not configured) -->
<div class="mailerlite-placeholder" style="background: linear-gradient(135deg, #7c3aed, #8b5cf6); color: white; border-radius: 15px; padding: 2rem; margin: 2rem 0; text-align: center; opacity: 0.7;">
  <h3 style="margin-bottom: 1rem; font-size: 1.4rem;">üìß Email Signup Form</h3>
  <p style="margin-bottom: 1.5rem;">Configure MailerLite settings in the admin panel to activate email collection</p>
  <div style="background: rgba(255,255,255,0.1); padding: 0.8rem 1.5rem; border-radius: 25px; display: inline-block;">
    MailerLite Form Placeholder
    <div class="ml-embedded" data-form="Pr0UV0"></div></div>

{% endif %}
